package de.hpi.bpt.chimera.parser;

import static org.junit.Assert.*;

import org.glassfish.jersey.test.JerseyTest;
import org.junit.Test;

import de.hpi.bpt.chimera.model.CaseModel;
import de.hpi.bpt.chimera.persistencemanager.DomainModelPersistenceManager;

public class CaseModelParserTest {
	String jsonString = "{\r\n\t\"_id\": \"591491c98c3ee6130cd6b0fd\",\r\n\t\"domainmodel\": {\r\n\t\t\"_id\": \"591491c98c3ee6130cd6b0fe\",\r\n\t\t\"name\": \"CaseModelJPAtest\",\r\n\t\t\"revision\": 4,\r\n\t\t\"__v\": 1,\r\n\t\t\"dataclasses\": [{\r\n\t\t\t\"name\": \"DataClass1\",\r\n\t\t\t\"is_event\": false,\r\n\t\t\t\"olc\": {\r\n\t\t\t\t\"intermediateThrowEvent\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1sx550y\"],\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_0gorp40\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_142rxnz\",\r\n\t\t\t\t\t\"name\": \"State1.5\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"],\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1sx550y\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_1jgrphh\",\r\n\t\t\t\t\t\"name\": \"State3\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_0gorp40\"]\r\n\t\t\t\t}],\r\n\t\t\t\t\"sequenceFlow\": [{\r\n\t\t\t\t\t\"id\": \"SequenceFlow_1d9kpvm\",\r\n\t\t\t\t\t\"sourceRef\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"targetRef\": \"State_142rxnz\"\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"SequenceFlow_1sx550y\",\r\n\t\t\t\t\t\"sourceRef\": \"State_142rxnz\",\r\n\t\t\t\t\t\"targetRef\": \"State_0x8fy3i\"\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"SequenceFlow_0gorp40\",\r\n\t\t\t\t\t\"sourceRef\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"targetRef\": \"State_1jgrphh\"\r\n\t\t\t\t}],\r\n\t\t\t\t\"state\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1sx550y\"],\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_0gorp40\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_142rxnz\",\r\n\t\t\t\t\t\"name\": \"State1.5\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"],\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1sx550y\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_1jgrphh\",\r\n\t\t\t\t\t\"name\": \"State3\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_0gorp40\"]\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t\"_id\": \"591492558c3ee6130cd6b103\",\r\n\t\t\t\"attributes\": [{\r\n\t\t\t\t\"name\": \"Attribute1\",\r\n\t\t\t\t\"datatype\": \"String\",\r\n\t\t\t\t\"_id\": \"591492558c3ee6130cd6b105\"\r\n\t\t\t}, {\r\n\t\t\t\t\"name\": \"Attribute2\",\r\n\t\t\t\t\"datatype\": \"Integer\",\r\n\t\t\t\t\"_id\": \"591492558c3ee6130cd6b104\"\r\n\t\t\t}]\r\n\t\t}, {\r\n\t\t\t\"name\": \"EventClass1\",\r\n\t\t\t\"is_event\": true,\r\n\t\t\t\"olc\": {\r\n\t\t\t\t\"intermediateThrowEvent\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}],\r\n\t\t\t\t\"sequenceFlow\": [{\r\n\t\t\t\t\t\"id\": \"SequenceFlow_1d9kpvm\",\r\n\t\t\t\t\t\"sourceRef\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"targetRef\": \"State_0x8fy3i\"\r\n\t\t\t\t}],\r\n\t\t\t\t\"state\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t\"_id\": \"591492558c3ee6130cd6b102\",\r\n\t\t\t\"attributes\": []\r\n\t\t}, {\r\n\t\t\t\"name\": \"EventClass2\",\r\n\t\t\t\"is_event\": true,\r\n\t\t\t\"olc\": {\r\n\t\t\t\t\"intermediateThrowEvent\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}],\r\n\t\t\t\t\"sequenceFlow\": [{\r\n\t\t\t\t\t\"id\": \"SequenceFlow_1d9kpvm\",\r\n\t\t\t\t\t\"sourceRef\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"targetRef\": \"State_0x8fy3i\"\r\n\t\t\t\t}],\r\n\t\t\t\t\"state\": [{\r\n\t\t\t\t\t\"id\": \"State_11u8x6w\",\r\n\t\t\t\t\t\"name\": \"State 1\",\r\n\t\t\t\t\t\"outgoing\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"id\": \"State_0x8fy3i\",\r\n\t\t\t\t\t\"name\": \"State 2\",\r\n\t\t\t\t\t\"incoming\": [\"SequenceFlow_1d9kpvm\"]\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t\"_id\": \"591492558c3ee6130cd6b101\",\r\n\t\t\t\"attributes\": []\r\n\t\t}]\r\n\t},\r\n\t\"name\": \"CaseModelJPAtest\",\r\n\t\"revision\": 2,\r\n\t\"__v\": 1,\r\n\t\"startconditions\": [],\r\n\t\"fragments\": [{\r\n\t\t\"_id\": \"591491c98c3ee6130cd6b0ff\",\r\n\t\t\"revision\": 2,\r\n\t\t\"content\": \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<bpmn:definitions xmlns:bpmn=\\\"http://www.omg.org/spec/BPMN/20100524/MODEL\\\" xmlns:bpmndi=\\\"http://www.omg.org/spec/BPMN/20100524/DI\\\" xmlns:di=\\\"http://www.omg.org/spec/DD/20100524/DI\\\" xmlns:dc=\\\"http://www.omg.org/spec/DD/20100524/DC\\\" xmlns:xsi=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" id=\\\"Definitions_1\\\" targetNamespace=\\\"http://bpmn.io/schema/bpmn\\\">\\n  <bpmn:process id=\\\"Process_1\\\" isExecutable=\\\"false\\\">\\n    <bpmn:startEvent id=\\\"StartEvent_1\\\">\\n      <bpmn:outgoing>SequenceFlow_0vy2x8y</bpmn:outgoing>\\n    </bpmn:startEvent>\\n    <bpmn:task id=\\\"Task_0wyhfye\\\" name=\\\"Task1a\\\">\\n      <bpmn:incoming>SequenceFlow_0vy2x8y</bpmn:incoming>\\n      <bpmn:outgoing>SequenceFlow_1uw5t49</bpmn:outgoing>\\n    </bpmn:task>\\n    <bpmn:sequenceFlow id=\\\"SequenceFlow_0vy2x8y\\\" sourceRef=\\\"StartEvent_1\\\" targetRef=\\\"Task_0wyhfye\\\" />\\n    <bpmn:endEvent id=\\\"EndEvent_0cah2hq\\\">\\n      <bpmn:incoming>SequenceFlow_1uw5t49</bpmn:incoming>\\n    </bpmn:endEvent>\\n    <bpmn:sequenceFlow id=\\\"SequenceFlow_1uw5t49\\\" sourceRef=\\\"Task_0wyhfye\\\" targetRef=\\\"EndEvent_0cah2hq\\\" />\\n  </bpmn:process>\\n  <bpmndi:BPMNDiagram id=\\\"BPMNDiagram_1\\\">\\n    <bpmndi:BPMNPlane id=\\\"BPMNPlane_1\\\" bpmnElement=\\\"Process_1\\\">\\n      <bpmndi:BPMNShape id=\\\"_BPMNShape_StartEvent_2\\\" bpmnElement=\\\"StartEvent_1\\\">\\n        <dc:Bounds x=\\\"183\\\" y=\\\"173\\\" width=\\\"36\\\" height=\\\"36\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"156\\\" y=\\\"209\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNShape id=\\\"Task_0wyhfye_di\\\" bpmnElement=\\\"Task_0wyhfye\\\">\\n        <dc:Bounds x=\\\"319\\\" y=\\\"151\\\" width=\\\"100\\\" height=\\\"80\\\" />\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNEdge id=\\\"SequenceFlow_0vy2x8y_di\\\" bpmnElement=\\\"SequenceFlow_0vy2x8y\\\">\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"219\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"251\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"251\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"319\\\" y=\\\"191\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"201\\\" y=\\\"110\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNEdge>\\n      <bpmndi:BPMNShape id=\\\"EndEvent_0cah2hq_di\\\" bpmnElement=\\\"EndEvent_0cah2hq\\\">\\n        <dc:Bounds x=\\\"535\\\" y=\\\"173\\\" width=\\\"36\\\" height=\\\"36\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"508\\\" y=\\\"209\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNEdge id=\\\"SequenceFlow_1uw5t49_di\\\" bpmnElement=\\\"SequenceFlow_1uw5t49\\\">\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"419\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"535\\\" y=\\\"191\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"431.5\\\" y=\\\"181\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNEdge>\\n    </bpmndi:BPMNPlane>\\n  </bpmndi:BPMNDiagram>\\n</bpmn:definitions>\\n\",\r\n\t\t\"name\": \"First Fragment\",\r\n\t\t\"__v\": 0\r\n\t}, {\r\n\t\t\"_id\": \"591491f58c3ee6130cd6b100\",\r\n\t\t\"name\": \"Second Fragment\",\r\n\t\t\"content\": \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<bpmn:definitions xmlns:bpmn=\\\"http://www.omg.org/spec/BPMN/20100524/MODEL\\\" xmlns:bpmndi=\\\"http://www.omg.org/spec/BPMN/20100524/DI\\\" xmlns:di=\\\"http://www.omg.org/spec/DD/20100524/DI\\\" xmlns:dc=\\\"http://www.omg.org/spec/DD/20100524/DC\\\" xmlns:xsi=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" id=\\\"Definitions_1\\\" targetNamespace=\\\"http://bpmn.io/schema/bpmn\\\">\\n  <bpmn:process id=\\\"Process_1\\\" isExecutable=\\\"false\\\">\\n    <bpmn:startEvent id=\\\"StartEvent_1\\\">\\n      <bpmn:outgoing>SequenceFlow_0vy2x8y</bpmn:outgoing>\\n    </bpmn:startEvent>\\n    <bpmn:task id=\\\"Task_0wyhfye\\\" name=\\\"2a\\\">\\n      <bpmn:incoming>SequenceFlow_0vy2x8y</bpmn:incoming>\\n      <bpmn:outgoing>SequenceFlow_1uw5t49</bpmn:outgoing>\\n    </bpmn:task>\\n    <bpmn:sequenceFlow id=\\\"SequenceFlow_0vy2x8y\\\" sourceRef=\\\"StartEvent_1\\\" targetRef=\\\"Task_0wyhfye\\\" />\\n    <bpmn:endEvent id=\\\"EndEvent_0cah2hq\\\">\\n      <bpmn:incoming>SequenceFlow_052dg4g</bpmn:incoming>\\n    </bpmn:endEvent>\\n    <bpmn:sequenceFlow id=\\\"SequenceFlow_1uw5t49\\\" sourceRef=\\\"Task_0wyhfye\\\" targetRef=\\\"ReceiveTask_174s0kj\\\" />\\n    <bpmn:sequenceFlow id=\\\"SequenceFlow_052dg4g\\\" sourceRef=\\\"ReceiveTask_174s0kj\\\" targetRef=\\\"EndEvent_0cah2hq\\\" />\\n    <bpmn:receiveTask id=\\\"ReceiveTask_174s0kj\\\" name=\\\"2b\\\">\\n      <bpmn:incoming>SequenceFlow_1uw5t49</bpmn:incoming>\\n      <bpmn:outgoing>SequenceFlow_052dg4g</bpmn:outgoing>\\n    </bpmn:receiveTask>\\n  </bpmn:process>\\n  <bpmndi:BPMNDiagram id=\\\"BPMNDiagram_1\\\">\\n    <bpmndi:BPMNPlane id=\\\"BPMNPlane_1\\\" bpmnElement=\\\"Process_1\\\">\\n      <bpmndi:BPMNShape id=\\\"_BPMNShape_StartEvent_2\\\" bpmnElement=\\\"StartEvent_1\\\">\\n        <dc:Bounds x=\\\"183\\\" y=\\\"173\\\" width=\\\"36\\\" height=\\\"36\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"156\\\" y=\\\"209\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNShape id=\\\"Task_0wyhfye_di\\\" bpmnElement=\\\"Task_0wyhfye\\\">\\n        <dc:Bounds x=\\\"319\\\" y=\\\"151\\\" width=\\\"100\\\" height=\\\"80\\\" />\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNEdge id=\\\"SequenceFlow_0vy2x8y_di\\\" bpmnElement=\\\"SequenceFlow_0vy2x8y\\\">\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"219\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"251\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"251\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"319\\\" y=\\\"191\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"201\\\" y=\\\"110\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNEdge>\\n      <bpmndi:BPMNShape id=\\\"EndEvent_0cah2hq_di\\\" bpmnElement=\\\"EndEvent_0cah2hq\\\">\\n        <dc:Bounds x=\\\"834\\\" y=\\\"173\\\" width=\\\"36\\\" height=\\\"36\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"807\\\" y=\\\"209\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNShape>\\n      <bpmndi:BPMNEdge id=\\\"SequenceFlow_1uw5t49_di\\\" bpmnElement=\\\"SequenceFlow_1uw5t49\\\">\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"419\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"567\\\" y=\\\"191\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"431.5\\\" y=\\\"181\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNEdge>\\n      <bpmndi:BPMNEdge id=\\\"SequenceFlow_052dg4g_di\\\" bpmnElement=\\\"SequenceFlow_052dg4g\\\">\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"667\\\" y=\\\"191\\\" />\\n        <di:waypoint xsi:type=\\\"dc:Point\\\" x=\\\"834\\\" y=\\\"191\\\" />\\n        <bpmndi:BPMNLabel>\\n          <dc:Bounds x=\\\"705.5\\\" y=\\\"181\\\" width=\\\"90\\\" height=\\\"20\\\" />\\n        </bpmndi:BPMNLabel>\\n      </bpmndi:BPMNEdge>\\n      <bpmndi:BPMNShape id=\\\"ReceiveTask_174s0kj_di\\\" bpmnElement=\\\"ReceiveTask_174s0kj\\\">\\n        <dc:Bounds x=\\\"567\\\" y=\\\"151\\\" width=\\\"100\\\" height=\\\"80\\\" />\\n      </bpmndi:BPMNShape>\\n    </bpmndi:BPMNPlane>\\n  </bpmndi:BPMNDiagram>\\n</bpmn:definitions>\\n\",\r\n\t\t\"revision\": 3,\r\n\t\t\"__v\": 0\r\n\t}],\r\n\t\"terminationconditions\": []\r\n}";
	@Test
	public void parseCaseModel() {
		CaseModel cm;
		cm = CaseModelParser.parseCaseModel(jsonString);
		DomainModelPersistenceManager.saveCaseModel(cm);
		CaseModel cm2;
		cm2 = DomainModelPersistenceManager.loadCaseModel("591491c98c3ee6130cd6b0fd");
		assertEquals("The id hasn't parsed and saved correcty.", "591491c98c3ee6130cd6b0fd", cm2.getId());
		assertEquals("The name hasn't parsed and saved correcty.", "CaseModelJPAtest", cm2.getName());
		assertEquals("The DataModel VersionNumber hasn't parsed and saved correcty.", 4, cm2.getDataModel().getVersionNumber());
		assertEquals("The First Fragments name hasn't parsed and saved correcty.", "First Fragment", cm2.getFragments().get(0).getName());
		assertEquals("The First DataModelClass' name hasn't parsed and saved correcty.", "DataClass1", cm2.getDataModel().getDataModelClasses().get(0).getName());
	}
}
